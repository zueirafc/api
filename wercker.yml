ruby: 2.2.3
box: phusion/passenger-ruby22

services:
  - postgres

build:
    steps:
        - bundle-install

        - rails-database-yml:
            service: postgresql

        - script:
            - RAILS_ENV=test bundle exec rake db:migrate --trace
            - RAILS_ENV=test bundle exec rake db:test:prepare
            - RAILS_ENV=test bundle exec rspec spec/

deploy:
    steps:
      - heroku-deploy:
          key-name: herokudeployment
      - script:
          name: Update database
          code: heroku run rake db:migrate --app zueira-fc
