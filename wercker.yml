ruby: 2.3.0
box: phusion/passenger-ruby22
services:
  - postgres
build:
  steps:
    - bundle-install
    - rails-database-yml
    - script:
        code: bundle exec rake db:schema:load RAILS_ENV=test

    - script:
        code: bundle exec rspec

    - script:
        name: Rubocop (static code analyzer)
        code: bundle exec rubocop -D

deploy:
    steps:
      - heroku-deploy:
          key-name: DEPLOYMENT_KEY
          install-toolbelt: true
          retry: true
          run: rake db:migrate --app $HEROKU_APP_NAME
